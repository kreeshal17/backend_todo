<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To-Do List</title>
    <style>
        .todo-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .todo-list li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .todo-list li.completed {
            background-color: #e6e6e6;
        }

        .todo-list li span {
            flex-grow: 1;
        }

        .todo-list li button {
            padding: 5px 10px;
            border: none;
            background-color: #f0f0f0;
            cursor: pointer;
        }
    </style>
</head>
<body>
<h1>To-Do List</h1>
<input type="text" id="task-input" placeholder="Enter a task">
<button id="add-task-btn">Add Task</button>
<ul id="todo-items" class="todo-list"></ul>
<script>
    const taskInput = document.getElementById('task-input');
    const addTaskBtn = document.getElementById('add-task-btn');
    const todoList = document.getElementById('todo-items');

    // Fetch initial data from API
    fetch('/api/todos')
        .then(response => response.json())
        .then(data => {
            renderTodoList(data);
        })
        .catch(error => {
            console.error('Error fetching to-do items:', error);
        });

    function renderTodoList(data) {
        todoList.innerHTML = '';
        data.forEach(todo => {
            const listItem = document.createElement('li');
            listItem.innerHTML = `
                    <input type="checkbox" ${todo.completed ? 'checked' : ''}>
                    <span>${todo.task}</span>
                    <button class="edit-btn">Edit</button>
                    <button class="delete-btn">Delete</button>
                `;

            listItem.querySelector('input[type="checkbox"]').addEventListener('change', () => {
                toggleTodoStatus(todo.id);
            });

            listItem.querySelector('.edit-btn').addEventListener('click', () => {
                editTodo(todo.id);
            });

            listItem.querySelector('.delete-btn').addEventListener('click', () => {
                deleteTodo(todo.id);
            });

            todoList.appendChild(listItem);
        });
    }

    function addTask() {
        const taskText = taskInput.value;
        if (taskText.trim() !== '') {
            fetch('/api/todos', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ task: taskText })
            })
                .then(response => response.json())
                .then(newTodo => {
                    mockData.push(newTodo);
                    renderTodoList(mockData);
                    taskInput.value = '';
                })
                .catch(error => {
                    console.error('Error adding task:', error);
                });
        }
    }

    function toggleTodoStatus(id) {
        const todo = mockData.find(todo => todo.id === id);
        if (todo) {
            fetch(`/api/todos/${id}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ completed: !todo.completed })
            })
                .then(response => response.json())
                .then(updatedTodo => {
                    todo.completed = updatedTodo.completed;
                    renderTodoList(mockData);
                })
                .catch(error => {
                    console.error('Error toggling todo status:', error);
                });
        }
    }

    function editTodo(id) {
        const todo = mockData.find(todo => todo.id === id);
        if (todo) {
            const newTask = prompt('Enter the new task:', todo.task);
            if (newTask) {
                fetch(`/api/todos/${id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ task: newTask })
                })
                    .then(response => response.json())
                    .then(updatedTodo => {
                        todo.task = updatedTodo.task;
                        renderTodoList(mockData);
                    })
                    .catch(error => {
                        console.error('Error editing todo:', error);
                    });
            }
        }
    }

    function deleteTodo(id) {
        fetch(`/api/todos/${id}`, {
            method: 'DELETE'
        })
            .then(response => {
                if (response.ok) {
                    const index = mockData.findIndex(todo => todo.id === id);
                    if (index !== -1) {
                        mockData.splice(index, 1);
                        renderTodoList(mockData);
                    }
                } else {
                    console.error('Error deleting todo:', response.statusText);
                }
            })
            .catch(error => {
                console.error('Error deleting todo:', error);
            });
    }
</script>
</body>
</html>